extends ../layout

prepend header
  title #{t('admin.admin_panel')} | #{config.web.name}

block main
  .row
    header 用户列表
    table.table.table-hover
      thead
        tr
          th= t('account.username')
          th= t('account.email')
          th 套餐
          th 流量
          th 余额
          th 操作
      tbody
        for account in accounts
          tr(data-id='#{account._id}')
            td= account.username
            td= account.email
            td= account.attribute.plans.join(', ')
            td #{(account.traffic_30days / 1000).toFixed(1)}G
            td= account.attribute.balance.toFixed(2)
            td
              .btn-group
                button(type='button', data-toggle='dropdown').btn.btn-info.btn-sm.dropdown-toggle
                  | 操作 &nbsp;
                  span.caret
                ul.dropdown-menu
                  li
                    a.action-create-payment(href='#') 创建充值记录
                  if account.attribute.balance <= 0 && account.attribute.plans.length == 0
                    li
                      a.action-delete-account(href='#') 删除账户

  .row
    header 网站列表
    table.table.table-hover
      thead
        tr
          th 用户名
          th 域名
          th 摘要
          th 操作
      tbody
        for site in sites
          tr(data-id='#{site._id}')
            td= site.account.username
            td= site.server_name.join(', ')
            td= siteSummary(site)
            td
              .btn-group
                button(type='button', data-toggle='dropdown').btn.btn-info.btn-sm.dropdown-toggle
                  | 操作 &nbsp;
                  span.caret
                ul.dropdown-menu
                  li
                    if site.is_enable
                      a.action-disable-site(href='#') 禁用
                    else
                      a.action-enable-site(href='#') 启用

  #create-payment-modal.modal.fade
    .modal-dialog
      .modal-content
        .modal-header
          button.close(type='button', data-dismiss='modal', aria-hidden='true') &times;
          h4.modal-title 创建充值记录
        .modal-body
          form.form-horizontal(method='post', role='form')
            .form-group
              label.col-sm-2.col-md-offset-1.control-label(for='account_id') ID
              .col-sm-5
                p#account_id.form-control-static
            .form-group
              label.col-sm-2.col-md-offset-1.control-label(for='amont') 金额
              .col-sm-5
                input#amont.form-control(type='text', name='amont', required)
            .form-group
              label.col-sm-2.col-md-offset-1.control-label(for='order_id') 订单号
              .col-sm-5
                input#order_id.form-control(type='order_id', name='order_id', required)

        .modal-footer
          button.btn.btn-danger(type='button', data-dismiss='modal') 关闭
          button.btn.btn-success.action-create-payment(type='button') 创建

prepend sidebar
  .row
    a.btn.btn-lg.btn-success(href='/admin/ticket/')= t('ticket.ticket_list')

append sidebar
  .row
    table.table.table-hover
      tbody
        tr
          td #{(pending_traffic / 1000 / 1000).toFixed(1)}M
          td pending
        tr
          td #{(traffic_24hours / 1000).toFixed(1)}G
          td 24 hour ago
        tr
          td #{(traffic_3days / 1000).toFixed(1)}G
          td 3 days ago
        tr
          td #{(traffic_7days / 1000).toFixed(1)}G
          td 7 days ago
        tr
          td #{(traffic_30days / 1000).toFixed(1)}G
          td 30 days ago

append footer
  script(src='/script/admin.js')